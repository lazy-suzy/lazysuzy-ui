<ng-container *ngIf="!isProductFetching">
  <div class="product-details-container">
    <button class="close-icon" mat-dialog-close>
      <mat-icon>close </mat-icon>
    </button>
    <div class="fl w-50">
      <div class="flex flex-column gallery-container" #gallery>
        <img
          *ngFor="let image of items; index as i"
          [src]="image.data.src"
          (click)="openLightbox(i)"
          class="br2"
        />
      </div>
    </div>
    <div class="fl w-50 pa3 product-details-container">
      <div #topContainer>
        <div class="flex w-100 justify-between items-end">
          <h2 class="mb0">{{ product.site }}</h2>
          <div *ngIf="product.wishlisted; else elseBlock">
            <div class="tile-icon wishlist-icon wishlist-container">
              <mat-icon (click)="wishlistProduct(product.sku, false)"
                >favorite
              </mat-icon>
              <span>Saved</span>
            </div>
          </div>
          <ng-template #elseBlock>
            <div class="tile-icon wishlist-icon wishlist-container">
              <mat-icon (click)="wishlistProduct(product.sku, true)"
                >favorite_border </mat-icon
              ><span> Save</span>
            </div>
          </ng-template>
        </div>
        <h4>{{ product.name }}</h4>

        <div class="price-container">
          <span class="product-price mr3">${{ productPrice }}</span>

          <span
            class="strike {{
              product.is_price !== product.was_price ? '' : 'dn'
            }}"
            >${{ product.was_price }}</span
          >
          <button mat-raised-button class="bg-red view-details-btn">
            <a
              (click)="openLink($event, product.product_url)"
              [href]="product.product_url"
              class="tr-viewDetails no-underline"
            >
              View Details
            </a>
          </button>
        </div>
        <hr class="modal-hr" *ngIf="variations.length > 0" />
        <div class="variations-container" *ngIf="variations.length > 0">
          <span class="title">Options</span>
          <div class="variation-options" *ngIf="isSwatchExist">
            <div
              *ngFor="let variation of variations; let i = index"
              class="variation-img-box"
              (click)="selectedVariation(variation, i, gallery)"
              [class.active]="selectedIndex === i"
            >
              <a>
                <span data-title="{{ variation.name }}">
                  <img
                    [src]="variation.swatch_image"
                    [alt]="variation.name"
                    class="variation-img"
                  />
                </span>
              </a>
            </div>
          </div>
          <div class="clear-btn" (click)="clearVariations()">Clear</div>
          <div class="flex flex-wrap variant-features-options-container">
            <div
              class="variant-feature-content"
              *ngFor="let item of product.selections | keyvalue"
            >
              <div
                class="variant-feature-options"
                *ngIf="item.value.select_type === 'multi_select'"
              >
                <div
                  class="feature-title pointer flex flex-wrap justify-between"
                >
                  <h5>{{ item.key | titlecase }}</h5>
                  <span class="arrow-icon"
                    ><mat-icon>arrow_drop_down</mat-icon></span
                  >
                </div>
                <div class="variant-feature-checkbox">
                  <div *ngFor="let option of item.value.options">
                    <mat-checkbox
                      (change)="onCheckChange($event, option, item.key)"
                    >
                      {{ option }}
                    </mat-checkbox>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class=" variant-features-options-container">
            <div
              class="variant-feature-content"
              *ngFor="let item of product.selections | keyvalue"
            >
              <div
                class=" variant-feature-options"
                *ngIf="item.value.select_type === 'single_select'"
              >
                <h5>{{ item.key | titlecase }}</h5>
                <div class="flex flex-wrap">
                  <div
                    class="variant-feature pointer w-third"
                    (click)="selectedOption(i, option, item.key)"
                    [class.active]="
                      selectedFeature === i && selectedAttribute === option
                    "
                    *ngFor="let option of item.value.options; let i = index"
                  >
                    {{ option }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr class="modal-hr" />
      </div>

      <div
        class="product-description-container {{
          variationsExist ? 'show' : 'hide'
        }}"
        [ngStyle]="topHeight"
      >
        <div class="mb2 pt-1" *ngIf="descriptionExist">
          <span class="title">Overview</span>
          <div class="mt1" [innerHTML]="description"></div>
        </div>
        <div *ngIf="featuresExist" class="mb2">
          <hr class="modal-hr" />
          <span class="title">Feature</span>
          <div class="mt1">
            <div [innerHTML]="features"></div>
          </div>
        </div>
        <div *ngIf="dimensionExist" class="mb2">
          <hr class="modal-hr" />
          <span class="title">Dimension</span>
          <div
            class="mt1 pb1 flex flex-wrap"
            *ngIf="isArray(product.dimension); else showDimensions"
          >
            <div
              *ngFor="let dimension of product.dimension"
              class="fl w-50 pa2"
            >
              <div class="dimension-title">{{ dimension.description }}</div>
              <div *ngIf="dimension.width > 0">
                Width: {{ dimension.width }}
              </div>
              <div *ngIf="dimension.depth > 0">
                Depth: {{ dimension.depth }}
              </div>
              <div *ngIf="dimension.height > 0">
                Height: {{ dimension.height }}
              </div>
              <br />
            </div>
          </div>
          <ng-template #showDimensions>
            <div class="pb1">
              {{ product.dimension }}
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</ng-container>
<img
  *ngIf="isProductFetching; else showDetails"
  [src]="spinner"
  class="loader"
/>

<ngx-json-ld [json]="schema"></ngx-json-ld>
<ng-container *ngIf="!isProductFetching">
    <div *ngIf="product || !invalidLink; else invalidProduct">
        <div class="product-details-container">
            <button class="close-icon" mat-dialog-close>
                <mat-icon>close</mat-icon>
            </button>
            <div class="fl w-50">
                <div class="flex flex-column gallery-container" #gallery>
                    <img *ngFor="let image of items; index as i" [src]="image.data.src" (click)="openLightbox(i)"
                         class="br2"/>
                </div>
            </div>
            <div class="fl w-50 pa3 product-details-container">
                <div #topContainer>
                    <div class="flex w-100 justify-between items-end">
                        <span class="mb1 lato font-16">{{ product.site }}</span>
                        <div *ngIf="product.wishlisted; else elseBlock">
                            <div class="tile-icon wishlist-icon wishlist-container">
                                <mat-icon (click)="wishlistProduct(product.sku, false)">favorite
                                </mat-icon>
                                <span>Saved</span>
                            </div>
                        </div>
                        <ng-template #elseBlock>
                            <div class="tile-icon wishlist-icon wishlist-container">
                                <mat-icon (click)="wishlistProduct(product.sku, true)">favorite_border</mat-icon>
                                <span>
                                    Save</span>
                            </div>
                        </ng-template>
                    </div>
                    <span class="open-sans font-18">{{ product.name }}</span>

                    <div class="price-container mt1">
                        <div class="price-font" style="margin-left:-0.5rem;">
                            <span class="product-price ml2 open-sans font-18" [ngClass]="{'sale':hasValidWasPrice,'product-price':!hasValidWasPrice}">
                                {{ renderPrice(productPrice) }}
                                <span class="ml2 product-price strike open-sans font-16 {{hasValidWasPrice ? '' : 'dn' }}">
                                    {{renderPrice(productWasPrice) }}
                                </span>
                            </span>

                        </div>
                        <div class="flex justify-between">
                            <button mat-raised-button class="bg-red view-details-btn"
                                    *ngIf="!utils.hasInventory(activeProduct) && !product.redirect &&product.product_url">
                                <a (click)="openLink($event, product.product_url)" [href]="product.product_url"
                                   class="tr-viewDetails no-underline">
                                    VIEW DETAILS
                                </a>
                            </button>

                            <select [(ngModel)]="quantity" class="quantity-selector mr2"
                                    *ngIf="utils.hasInventory(activeProduct)">
                                <option *ngFor="let i of quantityLimit(activeProduct.inventory_product_details.count)"
                                        [value]="i">{{ i }}</option>
                            </select>

                            <button mat-raised-button class="bg-red view-details-btn"
                                    *ngIf="utils.hasInventory(activeProduct)">
                                <a (click)="openCartModal()" class="tr-addToCart no-underline">
                                    ADD TO CART
                                </a>
                            </button>
                            <div *ngIf="errorMessage !== ''" class="invalid-feedback">
                                <div>{{ errorMessage }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="price-container-tabs mt1">
                        <div class="price-font" style="margin-left:-0.5rem;">
                            <span class="product-price ml2 open-sans font-18" [ngClass]="{'sale':hasValidWasPrice,'product-price':!hasValidWasPrice}">
                                {{ renderPrice(productPrice) }} &nbsp;
                                <span class="product-price strike open-sans font-16 {{hasValidWasPrice ? '' : 'dn' }}">
                                   {{ renderPrice(productWasPrice) }}
                                </span>
                            </span>
                        </div>
                        <div class="flex">
                            <button mat-raised-button class="bg-red view-details-btn"
                                    *ngIf="!utils.hasInventory(activeProduct) && !product.redirect">
                                <a (click)="openLink($event, product.product_url)" [href]="product.product_url"
                                   class="tr-viewDetails no-underline">
                                    VIEW DETAILS
                                </a>
                            </button>

                            <select [(ngModel)]="quantity" class="quantity-selector mr2"
                                    *ngIf="utils.hasInventory(activeProduct)">
                                <option *ngFor="let i of quantityLimit(activeProduct.inventory_product_details.count)"
                                        [value]="i">{{ i }}</option>
                            </select>

                            <button mat-raised-button class="bg-red view-details-btn"
                                    *ngIf="utils.hasInventory(activeProduct)">
                                <a (click)="openCartModal()" class="tr-addToCart no-underline">
                                    ADD TO CART
                                </a>
                            </button>
                            <div *ngIf="errorMessage !== ''" class="invalid-feedback">
                                <div>{{ errorMessage }}</div>
                            </div>
                        </div>
                    </div>

                    <div class="stock-info" *ngIf="utils.hasInventory(activeProduct) &&
                        (activeProduct.inventory_product_details.is_low || activeProduct.inventory_product_details.message)">
                        <div class="flex">
                            <span>
                                <mat-icon class="info-icon">info</mat-icon>
                            </span>
                            <div class="stock-msg" *ngIf="activeProduct.inventory_product_details.is_low">
                                Only {{ activeProduct.inventory_product_details.count > 10 ? '10' : activeProduct.inventory_product_details.count }}
                                left in stock.
                            </div>
                        </div>
                        <div class="shipping-msg">
                            {{ activeProduct.inventory_product_details.message }}
                        </div>
                    </div>
                    <ng-container *ngIf="product.redirect; else allConditions">
                        <hr class="modal-hr mt3" *ngIf="product.set && product.set.length > 0"/>
                    </ng-container>
                    <ng-template #allConditions>
                        <hr class="modal-hr mt3" *ngIf="isVariationExist || (product.set && product.set.length > 0)"/>
                    </ng-template>
                </div>
                <div class="product-description-container" [ngStyle]="topHeight">
                    <div *ngIf="!isSetItemInInventory">
                        <app-redirect *ngIf="product.redirect && !utils.hasInventory(activeProduct)"
                                      [redirectUrl]="product.redirect_url" [redirectDetails]="product.redirect_details"
                                      [category]="product.department_info[0]?.category_name"
                                      [categoryUrl]="product.department_info[0]?.category_url"
                                      [isHandset]="false">
                        </app-redirect>
                    </div>
                    <app-variations
                            *ngIf="isVariationExist && !product.redirect"
                            [variations]="product.variations"
                            [isSwatchExist]="isSwatchExist"
                            [inputSelections]="product.selections"
                            [hasSelection]="hasSelection"
                            (setPrice)="onSetPrice($event)"
                            (setImage)="onSetImage($event)"
                            (setSelectionChecked)="onSetSelectionChecked($event)"
                            (clearSelection)="onClearSelection($event)"
                            (setSelection)="onSetSelection($event)">
                    </app-variations>
                    <app-sets *ngIf="product.set && product.set.length > 0" [sets]="product.set" [brand]="product.site">
                    </app-sets>
                    <hr class="modal-hr mt-3"/>
                    <div class="mb2 pt-1" *ngIf="descriptionExist">
                        <span class="title">Overview</span>
                        <div class="mt1" [innerHTML]="description"></div>
                    </div>
                    <div *ngIf="featuresExist" class="mb2">
                        <hr class="modal-hr"/>
                        <span class="title">Features</span>
                        <div class="mt1">
                            <div [innerHTML]="features"></div>
                        </div>
                    </div>

                    <div *ngIf="dimensionExist;else emptySpace" class="mb2">
                        <hr class="modal-hr"/>
                        <span class="title">Dimensions</span>
                        <div class="mt1 pb1 flex flex-wrap" *ngIf="isArray(product.dimension) && product.dimension.length>0; else showDimensions">
                            <div *ngFor="let dimension of product.dimension" class="fl w-50 pa2">
                                <div class="dimension-title">{{ dimension.description }}</div>
                                <div *ngIf="dimension.width > 0">
                                    Width: {{ dimension.width }}
                                </div>
                                <div *ngIf="dimension.depth > 0">
                                    Depth: {{ dimension.depth }}
                                </div>
                                <div *ngIf="dimension.height > 0">
                                    Height: {{ dimension.height }}
                                </div>
                                <br/>
                            </div>
                        </div>
                        <ng-template #showDimensions>
                            <div class="pb1">
                                {{ product.dimension }}
                            </div>
                        </ng-template>
                    </div>
                    <ng-template #emptySpace>
                        &nbsp;
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
    <ng-template #invalidProduct>
        <div class="tc">
            <img [src]="invalidLinkImageSrc" class="invalid-url-image"/>
        </div>
    </ng-template>
</ng-container>
<img *ngIf="isProductFetching; else showDetails" [src]="spinner" class="loader"/>
